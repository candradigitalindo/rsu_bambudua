<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Quick Vital Signs</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
<div class="container mt-5">
    <h2>Test Quick Vital Signs Feature</h2>
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>Quick Vital Signs Form</h5>
                </div>
                <div class="card-body">
                    <form id="vitalSignsForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Admission ID</label>
                                <input type="number" class="form-control" name="admission_id" value="1" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Measurement Time</label>
                                <input type="datetime-local" class="form-control" name="measurement_time" required>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Nurse</label>
                            <input type="text" class="form-control" value="Test Nurse" readonly>
                            <input type="hidden" name="recorded_by_id" value="1">
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Blood Pressure (Systolic)</label>
                                <input type="number" class="form-control" name="blood_pressure_systolic" placeholder="120">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Blood Pressure (Diastolic)</label>
                                <input type="number" class="form-control" name="blood_pressure_diastolic" placeholder="80">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Heart Rate (bpm)</label>
                                <input type="number" class="form-control" name="heart_rate" placeholder="72">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Temperature (Â°C)</label>
                                <input type="number" step="0.1" class="form-control" name="temperature" placeholder="36.5">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Respiratory Rate (/min)</label>
                                <input type="number" class="form-control" name="respiratory_rate" placeholder="18">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Oxygen Saturation (%)</label>
                                <input type="number" class="form-control" name="oxygen_saturation" placeholder="98">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Consciousness Level</label>
                            <select class="form-control" name="consciousness_level">
                                <option value="">Select...</option>
                                <option value="alert">Alert</option>
                                <option value="drowsy">Drowsy</option>
                                <option value="confused">Confused</option>
                                <option value="unconscious">Unconscious</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" name="notes" rows="3" placeholder="Additional notes..."></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Record Vital Signs</button>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>Test Results</h5>
                </div>
                <div class="card-body">
                    <div id="testResults">
                        <p class="text-muted">Submit the form to see test results...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Set current time as default
document.querySelector('input[name="measurement_time"]').value = new Date().toISOString().slice(0, 16);

// Handle form submission
document.getElementById('vitalSignsForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = {};
    
    // Convert FormData to regular object
    for (let [key, value] of formData.entries()) {
        data[key] = value;
    }
    
    console.log('Sending data:', data);
    
    // Show loading
    document.getElementById('testResults').innerHTML = '<div class="spinner-border" role="status"></div> Testing...';
    
    // Test the endpoint
    fetch('http://localhost:8000/api/ruangan/vital-signs', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json',
            'X-CSRF-TOKEN': 'test-token', // In real app, get from meta tag
            'Authorization': 'Bearer your-token-here' // In real app, get from session
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        console.log('Response:', result);
        
        let html = '<h6>Response from API:</h6>';
        html += '<pre class="bg-light p-3">' + JSON.stringify(result, null, 2) + '</pre>';
        
        if (result.success) {
            html += '<div class="alert alert-success mt-3">';
            html += '<h6>Success!</h6>';
            html += '<p><strong>Message:</strong> ' + result.message + '</p>';
            if (result.nurse_info) {
                html += '<p><strong>Recorded by:</strong> ' + result.nurse_info.name + ' (' + result.nurse_info.role + ')</p>';
                html += '<p><strong>Time:</strong> ' + result.nurse_info.timestamp + '</p>';
            }
            html += '</div>';
        } else {
            html += '<div class="alert alert-danger mt-3">';
            html += '<h6>Error!</h6>';
            html += '<p>' + (result.message || 'Unknown error') + '</p>';
            html += '</div>';
        }
        
        document.getElementById('testResults').innerHTML = html;
    })
    .catch(error => {
        console.error('Error:', error);
        document.getElementById('testResults').innerHTML = 
            '<div class="alert alert-danger">Error: ' + error.message + '</div>';
    });
});

// Function to show toast messages
function showToast(type, message) {
    let bgClass = type === 'success' ? 'bg-success' : 'bg-danger';
    
    const toast = document.createElement('div');
    toast.className = `toast position-fixed top-0 end-0 m-3 ${bgClass} text-white`;
    toast.style.zIndex = '1050';
    
    toast.innerHTML = `
        <div class="toast-body">
            ${message}
        </div>
    `;
    
    document.body.appendChild(toast);
    
    // Auto remove after 3 seconds
    setTimeout(() => {
        toast.remove();
    }, 3000);
}
</script>

</body>
</html>